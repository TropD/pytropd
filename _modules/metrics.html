<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>metrics &mdash; PyTropD 1.0.0 documentation</title>
    
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1.0.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="PyTropD 1.0.0 documentation" href="../index.html" />
    <link rel="up" title="Module code" href="index.html" />
   
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body role="document">  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for metrics</h1><div class="highlight"><pre>
<span class="c1"># Written by Ori Adam Mar.21.2017</span>
<span class="c1"># Edited by Alison Ming Jul.4.2017</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">division</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">functions</span> <span class="kn">import</span> <span class="o">*</span>

<div class="viewcode-block" id="TropD_Metric_EDJ"><a class="viewcode-back" href="../reference.html#metrics.TropD_Metric_EDJ">[docs]</a><span class="k">def</span> <span class="nf">TropD_Metric_EDJ</span><span class="p">(</span><span class="n">U</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">lev</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">]),</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;peak&#39;</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">n_fit</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
  <span class="sd">&#39;&#39;&#39;TropD Eddy Driven Jet (EDJ) metric</span>
<span class="sd">       </span>
<span class="sd">     Latitude of maximum of the zonal wind at the level closest to the 850 hPa level</span>
<span class="sd">     </span>
<span class="sd">     Args:</span>
<span class="sd">       U (lat,lev) or U (lat,): Zonal mean zonal wind. Also takes surface wind </span>
<span class="sd">       lat : latitude vector</span>
<span class="sd">       lev: vertical level vector in hPa units</span>

<span class="sd">       method (str, optional): &#39;peak&#39; (default) |  &#39;max&#39; | &#39;fit&#39;</span>
<span class="sd">       </span>
<span class="sd">        peak (Default): Latitude of the maximum of the zonal wind at the level closest to the 850 hPa level (smoothing parameter n=30)</span>
<span class="sd">        </span>
<span class="sd">        max: Latitude of the maximum of the zonal wind at the level closest to the 850 hPa level (smoothing parameter n=6)</span>
<span class="sd">        fit: Latitude of the maximum of the zonal wind at the level closest to the 850 hPa level using a quadratic polynomial fit of data from gridpoints surrounding the gridpoint of the maximum</span>
<span class="sd">        </span>
<span class="sd">       n (int, optional): If n is not set (0), n=6 (default) is used in TropD_Calculate_MaxLat. Rank of moment used to calculate the position of max value. n = 1,2,4,6,8,...  </span>
<span class="sd">     </span>
<span class="sd">     Returns:</span>
<span class="sd">       tuple: PhiSH (ndarray), PhiNH (ndarray) Latitude of EDJ in SH and NH</span>

<span class="sd">  &#39;&#39;&#39;</span>

  <span class="k">try</span><span class="p">:</span>
    <span class="k">assert</span> <span class="p">(</span><span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="s2">&quot;__len__&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">n</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span>  
  <span class="k">except</span> <span class="ne">AssertionError</span><span class="p">:</span>
   <span class="k">print</span><span class="p">(</span><span class="s1">&#39;TropD_Metric_EDJ: ERROR : the smoothing parameter n must be &gt;= 0&#39;</span><span class="p">)</span>
   
  <span class="k">try</span><span class="p">:</span>
    <span class="k">assert</span><span class="p">(</span><span class="n">method</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;max&#39;</span><span class="p">,</span><span class="s1">&#39;peak&#39;</span><span class="p">])</span>
  <span class="k">except</span> <span class="ne">AssertionError</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;TropD_Metric_EDJ: ERROR : unrecognized method &#39;</span><span class="p">,</span> <span class="n">method</span><span class="p">)</span>

  <span class="n">eq_boundary</span> <span class="o">=</span> <span class="mi">15</span>
  <span class="n">polar_boundary</span> <span class="o">=</span> <span class="mi">70</span>
  
  <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lev</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
    <span class="n">u</span> <span class="o">=</span> <span class="n">U</span><span class="p">[:,</span><span class="n">find_nearest</span><span class="p">(</span><span class="n">lev</span><span class="p">,</span> <span class="mi">850</span><span class="p">)]</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">U</span><span class="p">)</span>
    
  <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;max&#39;</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">n</span><span class="p">:</span>
      <span class="n">PhiNH</span> <span class="o">=</span> <span class="n">TropD_Calculate_MaxLat</span><span class="p">(</span><span class="n">u</span><span class="p">[(</span><span class="n">lat</span> <span class="o">&gt;</span> <span class="n">eq_boundary</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lat</span> <span class="o">&lt;</span> <span class="n">polar_boundary</span><span class="p">)],</span>\
              <span class="n">lat</span><span class="p">[(</span><span class="n">lat</span> <span class="o">&gt;</span> <span class="n">eq_boundary</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lat</span> <span class="o">&lt;</span> <span class="n">polar_boundary</span><span class="p">)],</span> <span class="n">n</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>
      <span class="n">PhiSH</span> <span class="o">=</span> <span class="n">TropD_Calculate_MaxLat</span><span class="p">(</span><span class="n">u</span><span class="p">[(</span><span class="n">lat</span> <span class="o">&gt;</span> <span class="o">-</span><span class="n">polar_boundary</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lat</span> <span class="o">&lt;</span> <span class="o">-</span><span class="n">eq_boundary</span><span class="p">)],</span>\
              <span class="n">lat</span><span class="p">[(</span><span class="n">lat</span> <span class="o">&gt;</span> <span class="o">-</span><span class="n">polar_boundary</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lat</span> <span class="o">&lt;</span> <span class="o">-</span><span class="n">eq_boundary</span><span class="p">)],</span> <span class="n">n</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
      <span class="c1">#Default value of n=6 is used</span>
      <span class="n">PhiNH</span> <span class="o">=</span> <span class="n">TropD_Calculate_MaxLat</span><span class="p">(</span><span class="n">u</span><span class="p">[(</span><span class="n">lat</span> <span class="o">&gt;</span> <span class="n">eq_boundary</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lat</span> <span class="o">&lt;</span> <span class="n">polar_boundary</span><span class="p">)],</span>\
              <span class="n">lat</span><span class="p">[(</span><span class="n">lat</span> <span class="o">&gt;</span> <span class="n">eq_boundary</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lat</span> <span class="o">&lt;</span> <span class="n">polar_boundary</span><span class="p">)])</span>
      <span class="n">PhiSH</span> <span class="o">=</span> <span class="n">TropD_Calculate_MaxLat</span><span class="p">(</span><span class="n">u</span><span class="p">[(</span><span class="n">lat</span> <span class="o">&gt;</span> <span class="o">-</span><span class="n">polar_boundary</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lat</span> <span class="o">&lt;</span> <span class="o">-</span><span class="n">eq_boundary</span><span class="p">)],</span>\
              <span class="n">lat</span><span class="p">[(</span><span class="n">lat</span> <span class="o">&gt;</span> <span class="o">-</span><span class="n">polar_boundary</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lat</span> <span class="o">&lt;</span> <span class="o">-</span><span class="n">eq_boundary</span><span class="p">)])</span>
  
  <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;peak&#39;</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">n</span><span class="p">:</span>
      <span class="n">PhiNH</span> <span class="o">=</span> <span class="n">TropD_Calculate_MaxLat</span><span class="p">(</span><span class="n">u</span><span class="p">[(</span><span class="n">lat</span> <span class="o">&gt;</span> <span class="n">eq_boundary</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lat</span> <span class="o">&lt;</span> <span class="n">polar_boundary</span><span class="p">)],</span>\
              <span class="n">lat</span><span class="p">[(</span><span class="n">lat</span> <span class="o">&gt;</span> <span class="n">eq_boundary</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lat</span> <span class="o">&lt;</span> <span class="n">polar_boundary</span><span class="p">)],</span> <span class="n">n</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>
      <span class="n">PhiSH</span> <span class="o">=</span> <span class="n">TropD_Calculate_MaxLat</span><span class="p">(</span><span class="n">u</span><span class="p">[(</span><span class="n">lat</span> <span class="o">&gt;</span> <span class="o">-</span><span class="n">polar_boundary</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lat</span> <span class="o">&lt;</span> <span class="o">-</span><span class="n">eq_boundary</span><span class="p">)],</span>\
              <span class="n">lat</span><span class="p">[(</span><span class="n">lat</span> <span class="o">&gt;</span> <span class="o">-</span><span class="n">polar_boundary</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lat</span> <span class="o">&lt;</span> <span class="o">-</span><span class="n">eq_boundary</span><span class="p">)],</span> <span class="n">n</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">PhiNH</span> <span class="o">=</span> <span class="n">TropD_Calculate_MaxLat</span><span class="p">(</span><span class="n">u</span><span class="p">[(</span><span class="n">lat</span> <span class="o">&gt;</span> <span class="n">eq_boundary</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lat</span> <span class="o">&lt;</span> <span class="n">polar_boundary</span><span class="p">)],</span>\
              <span class="n">lat</span><span class="p">[(</span><span class="n">lat</span> <span class="o">&gt;</span> <span class="n">eq_boundary</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lat</span> <span class="o">&lt;</span> <span class="n">polar_boundary</span><span class="p">)],</span><span class="n">n</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
      <span class="n">PhiSH</span> <span class="o">=</span> <span class="n">TropD_Calculate_MaxLat</span><span class="p">(</span><span class="n">u</span><span class="p">[(</span><span class="n">lat</span> <span class="o">&gt;</span> <span class="o">-</span><span class="n">polar_boundary</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lat</span> <span class="o">&lt;</span> <span class="o">-</span><span class="n">eq_boundary</span><span class="p">)],</span>\
              <span class="n">lat</span><span class="p">[(</span><span class="n">lat</span> <span class="o">&gt;</span> <span class="o">-</span><span class="n">polar_boundary</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lat</span> <span class="o">&lt;</span> <span class="o">-</span><span class="n">eq_boundary</span><span class="p">)],</span><span class="n">n</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
  
  <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;fit&#39;</span><span class="p">:</span>
    <span class="n">Uh</span> <span class="o">=</span> <span class="n">u</span><span class="p">[(</span><span class="n">lat</span> <span class="o">&gt;</span> <span class="n">eq_boundary</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lat</span> <span class="o">&lt;</span> <span class="n">polar_boundary</span><span class="p">)]</span>
    <span class="n">Lat</span> <span class="o">=</span> <span class="n">lat</span><span class="p">[(</span><span class="n">lat</span> <span class="o">&gt;</span> <span class="n">eq_boundary</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lat</span> <span class="o">&lt;</span> <span class="n">polar_boundary</span><span class="p">)]</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">Uh</span><span class="p">)</span>
    <span class="n">Im</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanargmax</span><span class="p">(</span><span class="n">Uh</span><span class="p">)</span>
     
    <span class="k">if</span> <span class="p">(</span><span class="n">Im</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">Im</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">Uh</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
      <span class="n">PhiNH</span> <span class="o">=</span> <span class="n">Lat</span><span class="p">[</span><span class="n">Im</span><span class="p">]</span>
    
    <span class="k">elif</span> <span class="p">(</span><span class="n">n_fit</span> <span class="o">&gt;</span> <span class="n">Im</span> <span class="ow">or</span> <span class="n">n_fit</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">Uh</span><span class="p">)</span><span class="o">-</span><span class="n">Im</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
      <span class="n">N</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">Im</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">Uh</span><span class="p">)</span><span class="o">-</span><span class="n">Im</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
      <span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyfit</span><span class="p">(</span><span class="n">Lat</span><span class="p">[</span><span class="n">Im</span><span class="o">-</span><span class="n">N</span><span class="p">:</span><span class="n">Im</span><span class="o">+</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span> <span class="n">Uh</span><span class="p">[</span><span class="n">Im</span><span class="o">-</span><span class="n">N</span><span class="p">:</span><span class="n">Im</span><span class="o">+</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span><span class="mi">2</span><span class="p">)</span> 
      <span class="n">PhiNH</span> <span class="o">=</span> <span class="o">-</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyfit</span><span class="p">(</span><span class="n">Lat</span><span class="p">[</span><span class="n">Im</span><span class="o">-</span><span class="n">n_fit</span><span class="p">:</span><span class="n">Im</span><span class="o">+</span><span class="n">n_fit</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span> <span class="n">Uh</span><span class="p">[</span><span class="n">Im</span><span class="o">-</span><span class="n">n_fit</span><span class="p">:</span><span class="n">Im</span><span class="o">+</span><span class="n">n_fit</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span><span class="mi">2</span><span class="p">)</span> 
      <span class="n">PhiNH</span> <span class="o">=</span> <span class="o">-</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    
    <span class="n">Uh</span> <span class="o">=</span> <span class="n">u</span><span class="p">[(</span><span class="n">lat</span> <span class="o">&gt;</span> <span class="o">-</span><span class="n">polar_boundary</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lat</span> <span class="o">&lt;</span> <span class="o">-</span><span class="n">eq_boundary</span><span class="p">)]</span>
    <span class="n">Lat</span> <span class="o">=</span> <span class="n">lat</span><span class="p">[(</span><span class="n">lat</span> <span class="o">&gt;</span> <span class="o">-</span><span class="n">polar_boundary</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lat</span> <span class="o">&lt;</span> <span class="o">-</span><span class="n">eq_boundary</span><span class="p">)]</span>
    
    <span class="n">m</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">Uh</span><span class="p">)</span>
    <span class="n">Im</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanargmax</span><span class="p">(</span><span class="n">Uh</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="p">(</span><span class="n">Im</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">Im</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">Uh</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
      <span class="n">PhiSH</span> <span class="o">=</span> <span class="n">Lat</span><span class="p">[</span><span class="n">Im</span><span class="p">]</span>
    
    <span class="k">elif</span> <span class="p">(</span><span class="n">n_fit</span> <span class="o">&gt;</span> <span class="n">Im</span> <span class="ow">or</span> <span class="n">n_fit</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">Uh</span><span class="p">)</span><span class="o">-</span><span class="n">Im</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
      <span class="n">N</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">Im</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">Uh</span><span class="p">)</span><span class="o">-</span><span class="n">Im</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
      <span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyfit</span><span class="p">(</span><span class="n">Lat</span><span class="p">[</span><span class="n">Im</span><span class="o">-</span><span class="n">N</span><span class="p">:</span><span class="n">Im</span><span class="o">+</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span> <span class="n">Uh</span><span class="p">[</span><span class="n">Im</span><span class="o">-</span><span class="n">N</span><span class="p">:</span><span class="n">Im</span><span class="o">+</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span><span class="mi">2</span><span class="p">)</span> 
      <span class="n">PhiSH</span> <span class="o">=</span> <span class="o">-</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polyfit</span><span class="p">(</span><span class="n">Lat</span><span class="p">[</span><span class="n">Im</span><span class="o">-</span><span class="n">n_fit</span><span class="p">:</span><span class="n">Im</span><span class="o">+</span><span class="n">n_fit</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span> <span class="n">Uh</span><span class="p">[</span><span class="n">Im</span><span class="o">-</span><span class="n">n_fit</span><span class="p">:</span><span class="n">Im</span><span class="o">+</span><span class="n">n_fit</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span><span class="mi">2</span><span class="p">)</span> 
      <span class="n">PhiSH</span> <span class="o">=</span> <span class="o">-</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
  
  <span class="k">else</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;TropD_Metric_EDJ: ERROR: unrecognized method &#39;</span><span class="p">,</span> <span class="n">method</span><span class="p">)</span>

  <span class="k">return</span> <span class="n">PhiSH</span><span class="p">,</span> <span class="n">PhiNH</span></div>




<div class="viewcode-block" id="TropD_Metric_OLR"><a class="viewcode-back" href="../reference.html#metrics.TropD_Metric_OLR">[docs]</a><span class="k">def</span> <span class="nf">TropD_Metric_OLR</span><span class="p">(</span><span class="n">olr</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;250W&#39;</span><span class="p">,</span> <span class="n">Cutoff</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="mi">6</span><span class="p">)):</span>
  <span class="sd">&quot;&quot;&quot;TropD Outgoing Longwave Radiation (OLR) metric</span>
<span class="sd">     </span>
<span class="sd">     Args:</span>
<span class="sd">     </span>
<span class="sd">       olr(lat,): zonal mean TOA olr (positive)</span>
<span class="sd">       </span>
<span class="sd">       lat: equally spaced latitude column vector</span>
<span class="sd">        </span>
<span class="sd">       method (str, optional):</span>

<span class="sd">         &#39;250W&#39;(Default): the first latitude poleward of the tropical OLR maximum in each hemisphere where OLR crosses 250W/m^2</span>
<span class="sd">         </span>
<span class="sd">         &#39;20W&#39;: the first latitude poleward of the tropical OLR maximum in each hemisphere where OLR crosses the tropical OLR max minus 20W/m^2</span>
<span class="sd">         </span>
<span class="sd">         &#39;cutoff&#39;: the first latitude poleward of the tropical OLR maximum in each hemisphere where OLR crosses a specified cutoff value</span>
<span class="sd">         </span>
<span class="sd">         &#39;10Perc&#39;: the first latitude poleward of the tropical OLR maximum in each hemisphere where OLR is 10# smaller than the tropical OLR maximum</span>
<span class="sd">         </span>
<span class="sd">         &#39;max&#39;: the latitude of maximum of tropical olr in each hemisphere with the smoothing paramerer n=6 in TropD_Calculate_MaxLat</span>
<span class="sd">         </span>
<span class="sd">         &#39;peak&#39;: the latitude of maximum of tropical olr in each hemisphere with the smoothing parameter n=30 in TropD_Calculate_MaxLat</span>
<span class="sd">       </span>
<span class="sd">       </span>
<span class="sd">       Cutoff (float, optional): Scalar. For the method &#39;cutoff&#39;, Cutoff specifies the OLR cutoff value. </span>
<span class="sd">       </span>
<span class="sd">       n (int, optional): For the &#39;max&#39; method, n is the smoothing parameter in TropD_Calculate_MaxLat</span>
<span class="sd">     </span>
<span class="sd">     Returns:</span>
<span class="sd">     </span>
<span class="sd">       tuple: PhiSH (ndarray), PhiNH (ndarray) Latitude of near equator OLR threshold crossing in SH and NH</span>
<span class="sd">     </span>
<span class="sd">  &quot;&quot;&quot;</span>

  <span class="k">try</span><span class="p">:</span>
    <span class="k">assert</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="nb">int</span><span class="p">))</span> 
  <span class="k">except</span> <span class="ne">AssertionError</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;TropD_Metric_OLR: ERROR: the smoothing parameter n must be an integer&#39;</span><span class="p">)</span>
  
  <span class="k">try</span><span class="p">:</span>
    <span class="k">assert</span><span class="p">(</span><span class="n">n</span><span class="o">&gt;=</span><span class="mi">1</span><span class="p">)</span> 
  <span class="k">except</span> <span class="ne">AssertionError</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;TropD_Metric_OLR: ERROR: the smoothing parameter n must be &gt;= 1&#39;</span><span class="p">)</span>

  
  <span class="c1"># make latitude vector monotonically increasing</span>
  <span class="k">if</span> <span class="n">lat</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">lat</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
    <span class="n">olr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">olr</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">lat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">lat</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
    
  <span class="n">eq_boundary</span> <span class="o">=</span> <span class="mi">5</span>
  <span class="n">subpolar_boundary</span> <span class="o">=</span> <span class="mi">40</span>
  <span class="n">polar_boundary</span> <span class="o">=</span> <span class="mi">60</span>
  <span class="c1"># NH</span>
  <span class="n">olr_max_lat_NH</span> <span class="o">=</span> <span class="n">TropD_Calculate_MaxLat</span><span class="p">(</span><span class="n">olr</span><span class="p">[(</span><span class="n">lat</span> <span class="o">&gt;</span> <span class="n">eq_boundary</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lat</span> <span class="o">&lt;</span> <span class="n">subpolar_boundary</span><span class="p">)],</span>\
                    <span class="n">lat</span><span class="p">[(</span><span class="n">lat</span> <span class="o">&gt;</span> <span class="n">eq_boundary</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lat</span> <span class="o">&lt;</span> <span class="n">subpolar_boundary</span><span class="p">)])</span>
  <span class="n">olr_max_NH</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">olr</span><span class="p">[(</span><span class="n">lat</span> <span class="o">&gt;</span> <span class="n">eq_boundary</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lat</span> <span class="o">&lt;</span> <span class="n">subpolar_boundary</span><span class="p">)])</span>

  <span class="c1"># SH</span>
  <span class="n">olr_max_lat_SH</span> <span class="o">=</span> <span class="n">TropD_Calculate_MaxLat</span><span class="p">(</span><span class="n">olr</span><span class="p">[(</span><span class="n">lat</span> <span class="o">&gt;</span> <span class="o">-</span><span class="n">subpolar_boundary</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lat</span> <span class="o">&lt;</span> <span class="o">-</span><span class="n">eq_boundary</span><span class="p">)],</span>\
                    <span class="n">lat</span><span class="p">[(</span><span class="n">lat</span> <span class="o">&gt;</span> <span class="o">-</span><span class="n">subpolar_boundary</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lat</span> <span class="o">&lt;</span> <span class="o">-</span><span class="n">eq_boundary</span><span class="p">)])</span>
  <span class="n">olr_max_SH</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">olr</span><span class="p">[(</span><span class="n">lat</span> <span class="o">&gt;</span> <span class="o">-</span><span class="n">subpolar_boundary</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lat</span> <span class="o">&lt;</span> <span class="o">-</span><span class="n">eq_boundary</span><span class="p">)])</span>

  <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;20W&#39;</span><span class="p">:</span>
    <span class="n">PhiNH</span> <span class="o">=</span> <span class="n">TropD_Calculate_ZeroCrossing</span><span class="p">(</span><span class="n">olr</span><span class="p">[(</span><span class="n">lat</span> <span class="o">&gt;</span> <span class="n">olr_max_lat_NH</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lat</span> <span class="o">&lt;</span> <span class="n">polar_boundary</span><span class="p">)]</span> <span class="o">-</span> <span class="n">olr_max_NH</span> <span class="o">+</span> <span class="mi">20</span><span class="p">,</span>\
                    <span class="n">lat</span><span class="p">[(</span><span class="n">lat</span> <span class="o">&gt;</span> <span class="n">olr_max_lat_NH</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lat</span> <span class="o">&lt;</span> <span class="n">polar_boundary</span><span class="p">)])</span>
    <span class="n">PhiSH</span> <span class="o">=</span> <span class="n">TropD_Calculate_ZeroCrossing</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">olr</span><span class="p">[(</span><span class="n">lat</span> <span class="o">&lt;</span> <span class="n">olr_max_lat_SH</span><span class="p">)</span> <span class="o">&amp;</span> \
                    <span class="p">(</span><span class="n">lat</span> <span class="o">&gt;</span> <span class="o">-</span><span class="n">polar_boundary</span><span class="p">)],</span><span class="mi">0</span><span class="p">)</span> <span class="o">-</span> <span class="n">olr_max_SH</span> <span class="o">+</span> <span class="mi">20</span><span class="p">,</span>\
                    <span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">lat</span><span class="p">[(</span><span class="n">lat</span> <span class="o">&lt;</span> <span class="n">olr_max_lat_SH</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lat</span> <span class="o">&gt;</span> <span class="o">-</span><span class="n">polar_boundary</span><span class="p">)],</span><span class="mi">0</span><span class="p">))</span>

  <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;250W&#39;</span><span class="p">:</span>
    <span class="n">PhiNH</span> <span class="o">=</span> <span class="n">TropD_Calculate_ZeroCrossing</span><span class="p">(</span><span class="n">olr</span><span class="p">[(</span><span class="n">lat</span> <span class="o">&gt;</span> <span class="n">olr_max_lat_NH</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lat</span> <span class="o">&lt;</span> <span class="n">polar_boundary</span><span class="p">)]</span> <span class="o">-</span> <span class="mi">250</span><span class="p">,</span>\
                    <span class="n">lat</span><span class="p">[(</span><span class="n">lat</span> <span class="o">&gt;</span> <span class="n">olr_max_lat_NH</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lat</span> <span class="o">&lt;</span> <span class="n">polar_boundary</span><span class="p">)])</span>
    <span class="n">PhiSH</span> <span class="o">=</span> <span class="n">TropD_Calculate_ZeroCrossing</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">olr</span><span class="p">[(</span><span class="n">lat</span> <span class="o">&lt;</span> <span class="n">olr_max_lat_SH</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lat</span> <span class="o">&gt;</span> <span class="o">-</span><span class="n">polar_boundary</span><span class="p">)],</span><span class="mi">0</span><span class="p">)</span> <span class="o">-</span> <span class="mi">250</span><span class="p">,</span>\
                    <span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">lat</span><span class="p">[(</span><span class="n">lat</span> <span class="o">&lt;</span> <span class="n">olr_max_lat_SH</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lat</span> <span class="o">&gt;</span> <span class="o">-</span><span class="n">polar_boundary</span><span class="p">)],</span><span class="mi">0</span><span class="p">))</span>

  <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;cutoff&#39;</span><span class="p">:</span>
    <span class="n">PhiNH</span> <span class="o">=</span> <span class="n">TropD_Calculate_ZeroCrossing</span><span class="p">(</span><span class="n">olr</span><span class="p">[(</span><span class="n">lat</span> <span class="o">&gt;</span> <span class="n">olr_max_lat_NH</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lat</span> <span class="o">&lt;</span> <span class="n">polar_boundary</span><span class="p">)]</span> <span class="o">-</span> <span class="n">Cutoff</span><span class="p">,</span>\
                    <span class="n">lat</span><span class="p">[(</span><span class="n">lat</span> <span class="o">&gt;</span> <span class="n">olr_max_lat_NH</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lat</span> <span class="o">&lt;</span> <span class="n">polar_boundary</span><span class="p">)])</span>
    <span class="n">PhiSH</span> <span class="o">=</span> <span class="n">TropD_Calculate_ZeroCrossing</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">olr</span><span class="p">[(</span><span class="n">lat</span> <span class="o">&lt;</span> <span class="n">olr_max_lat_SH</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lat</span> <span class="o">&gt;</span> <span class="o">-</span><span class="n">polar_boundary</span><span class="p">)],</span><span class="mi">0</span><span class="p">)</span> <span class="o">-</span> <span class="n">Cutoff</span><span class="p">,</span>\
                    <span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">lat</span><span class="p">[(</span><span class="n">lat</span> <span class="o">&lt;</span> <span class="n">olr_max_lat_SH</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lat</span> <span class="o">&gt;</span> <span class="o">-</span><span class="n">polar_boundary</span><span class="p">)],</span><span class="mi">0</span><span class="p">))</span>
  
  <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;10Perc&#39;</span><span class="p">:</span>
    <span class="n">PhiNH</span> <span class="o">=</span> <span class="n">TropD_Calculate_ZeroCrossing</span><span class="p">(</span><span class="n">olr</span><span class="p">[(</span><span class="n">lat</span> <span class="o">&gt;</span> <span class="n">olr_max_lat_NH</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lat</span> <span class="o">&lt;</span> <span class="n">polar_boundary</span><span class="p">)]</span> <span class="o">/</span> <span class="n">olr_max_NH</span> <span class="o">-</span> <span class="mf">0.9</span><span class="p">,</span>\
                    <span class="n">lat</span><span class="p">[(</span><span class="n">lat</span> <span class="o">&gt;</span> <span class="n">olr_max_lat_NH</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lat</span> <span class="o">&lt;</span> <span class="n">polar_boundary</span><span class="p">)])</span>
    <span class="n">PhiSH</span> <span class="o">=</span> <span class="n">TropD_Calculate_ZeroCrossing</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">olr</span><span class="p">[(</span><span class="n">lat</span> <span class="o">&lt;</span> <span class="n">olr_max_lat_SH</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lat</span> <span class="o">&gt;</span> <span class="o">-</span><span class="n">polar_boundary</span><span class="p">)],</span><span class="mi">0</span><span class="p">)</span> \
                    <span class="o">/</span> <span class="n">olr_max_SH</span> <span class="o">-</span> <span class="mf">0.9</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">lat</span><span class="p">[(</span><span class="n">lat</span> <span class="o">&lt;</span> <span class="n">olr_max_lat_SH</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lat</span> <span class="o">&gt;</span> <span class="o">-</span><span class="n">polar_boundary</span><span class="p">)],</span><span class="mi">0</span><span class="p">))</span>

  <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;max&#39;</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">Cutoff_is_set</span><span class="p">:</span>
      <span class="n">PhiNH</span> <span class="o">=</span> <span class="n">TropD_Calculate_MaxLat</span><span class="p">(</span><span class="n">olr</span><span class="p">[(</span><span class="n">lat</span> <span class="o">&gt;</span> <span class="n">eq_boundary</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lat</span> <span class="o">&lt;</span> <span class="n">subpolar_boundary</span><span class="p">)],</span>\
                    <span class="n">lat</span><span class="p">[(</span><span class="n">lat</span> <span class="o">&gt;</span> <span class="n">eq_boundary</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lat</span> <span class="o">&lt;</span> <span class="n">subpolar_boundary</span><span class="p">)],</span> <span class="n">n</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>
      <span class="n">PhiSH</span> <span class="o">=</span> <span class="n">TropD_Calculate_MaxLat</span><span class="p">(</span><span class="n">olr</span><span class="p">[(</span><span class="n">lat</span> <span class="o">&gt;</span> <span class="o">-</span><span class="n">subpolar_boundary</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lat</span> <span class="o">&lt;</span> <span class="o">-</span><span class="n">eq_boundary</span><span class="p">)],</span>\
                    <span class="n">lat</span><span class="p">[(</span><span class="n">lat</span> <span class="o">&gt;</span> <span class="o">-</span><span class="n">subpolar_boundary</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lat</span> <span class="o">&lt;</span> <span class="o">-</span><span class="n">eq_boundary</span><span class="p">)],</span> <span class="n">n</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">PhiNH</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">olr_max_lat_NH</span><span class="p">)</span>
      <span class="n">PhiSH</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">olr_max_lat_SH</span><span class="p">)</span>
 
  <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;peak&#39;</span><span class="p">:</span>
    <span class="n">PhiNH</span> <span class="o">=</span> <span class="n">TropD_Calculate_MaxLat</span><span class="p">(</span><span class="n">olr</span><span class="p">[(</span><span class="n">lat</span> <span class="o">&gt;</span> <span class="n">eq_boundary</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lat</span> <span class="o">&lt;</span> <span class="n">subpolar_boundary</span><span class="p">)],</span>\
                    <span class="n">lat</span><span class="p">[(</span><span class="n">lat</span> <span class="o">&gt;</span> <span class="n">eq_boundary</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lat</span> <span class="o">&lt;</span> <span class="n">subpolar_boundary</span><span class="p">)],</span><span class="n">n</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
    <span class="n">PhiSH</span> <span class="o">=</span> <span class="n">TropD_Calculate_MaxLat</span><span class="p">(</span><span class="n">olr</span><span class="p">[(</span><span class="n">lat</span> <span class="o">&gt;</span> <span class="o">-</span><span class="n">subpolar_boundary</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lat</span> <span class="o">&lt;</span> <span class="o">-</span><span class="n">eq_boundary</span><span class="p">)],</span>\
                    <span class="n">lat</span><span class="p">[(</span><span class="n">lat</span> <span class="o">&gt;</span> <span class="o">-</span><span class="n">subpolar_boundary</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lat</span> <span class="o">&lt;</span> <span class="o">-</span><span class="n">eq_boundary</span><span class="p">)],</span> <span class="n">n</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>

  <span class="k">else</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;TropD_Metric_OLR: unrecognized method &#39;</span><span class="p">,</span> <span class="n">method</span><span class="p">)</span>

    <span class="n">PhiNH</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">PhiSH</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
  
  <span class="k">return</span> <span class="n">PhiSH</span><span class="p">,</span> <span class="n">PhiNH</span></div>
    
    
<div class="viewcode-block" id="TropD_Metric_PE"><a class="viewcode-back" href="../reference.html#metrics.TropD_Metric_PE">[docs]</a><span class="k">def</span> <span class="nf">TropD_Metric_PE</span><span class="p">(</span><span class="n">pe</span><span class="p">,</span><span class="n">lat</span><span class="p">,</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;zero_crossing&#39;</span><span class="p">,</span><span class="n">lat_uncertainty</span><span class="o">=</span><span class="mf">0.0</span><span class="p">):</span>

  <span class="sd">&#39;&#39;&#39; TropD Precipitation minus Evaporation (PE) metric</span>
<span class="sd">     </span>
<span class="sd">      Args:</span>

<span class="sd">        pe(lat,): zonal-mean precipitation minus evaporation</span>
<span class="sd">   </span>
<span class="sd">        lat: equally spaced latitude column vector</span>

<span class="sd">        method (str): </span>
<span class="sd">       </span>
<span class="sd">          &#39;zero_crossing&#39;: the first latitude poleward of the subtropical minimum where P-E changes from negative to positive values. Only one method so far.</span>
<span class="sd">  </span>
<span class="sd">        lat_uncertainty (float, optional): The minimal distance allowed between the first and second zero crossings along lat</span>

<span class="sd">      Returns:</span>
<span class="sd">        tuple: PhiSH (ndarray), PhiNH (ndarray) Latitude of first subtropical P-E zero crossing in SH and NH</span>

<span class="sd">  &#39;&#39;&#39;</span>    
  <span class="k">try</span><span class="p">:</span>
    <span class="k">assert</span><span class="p">(</span><span class="n">method</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;zero_crossing&#39;</span><span class="p">])</span>
  <span class="k">except</span> <span class="ne">AssertionError</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;TropD_Metric_PE: ERROR : unrecognized method &#39;</span><span class="p">,</span> <span class="n">method</span><span class="p">)</span>
    
  <span class="c1"># make latitude vector monotonically increasing</span>
  <span class="k">if</span> <span class="n">lat</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">lat</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
      <span class="n">pe</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">pe</span><span class="p">)</span>
      <span class="n">lat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">lat</span><span class="p">)</span>
    
  <span class="c1"># The gradient of PE is used to determine whether PE becomes positive at the zero crossing</span>
  <span class="n">ped</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">lat</span><span class="p">,</span> <span class="p">(</span><span class="n">lat</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">lat</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span><span class="o">/</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">pe</span><span class="p">))</span>
    
  <span class="c1"># define latitudes of boundaries certain regions </span>
  <span class="n">eq_boundary</span> <span class="o">=</span> <span class="mi">5</span>
  <span class="n">subpolar_boundary</span> <span class="o">=</span> <span class="mi">50</span>
  <span class="n">polar_boundary</span> <span class="o">=</span> <span class="mi">60</span>

    
  <span class="c1"># NH</span>
  <span class="n">M1</span> <span class="o">=</span> <span class="n">TropD_Calculate_MaxLat</span><span class="p">(</span><span class="o">-</span><span class="n">pe</span><span class="p">[(</span><span class="n">lat</span> <span class="o">&gt;</span> <span class="n">eq_boundary</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lat</span> <span class="o">&lt;</span> <span class="n">subpolar_boundary</span><span class="p">)],</span>\
                 <span class="n">lat</span><span class="p">[(</span><span class="n">lat</span> <span class="o">&gt;</span> <span class="n">eq_boundary</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lat</span> <span class="o">&lt;</span> <span class="n">subpolar_boundary</span><span class="p">)],</span> <span class="n">n</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
  <span class="n">ZC1</span> <span class="o">=</span> <span class="n">TropD_Calculate_ZeroCrossing</span><span class="p">(</span><span class="n">pe</span><span class="p">[(</span><span class="n">lat</span> <span class="o">&gt;</span> <span class="n">M1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lat</span> <span class="o">&lt;</span> <span class="n">polar_boundary</span><span class="p">)],</span> \
                 <span class="n">lat</span><span class="p">[(</span><span class="n">lat</span> <span class="o">&gt;</span> <span class="n">M1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lat</span> <span class="o">&lt;</span> <span class="n">polar_boundary</span><span class="p">)],</span> <span class="n">lat_uncertainty</span><span class="o">=</span><span class="n">lat_uncertainty</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">ZC1</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">ped</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
    <span class="n">PhiNH</span> <span class="o">=</span> <span class="n">ZC1</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="n">PhiNH</span> <span class="o">=</span> <span class="n">TropD_Calculate_ZeroCrossing</span><span class="p">(</span><span class="n">pe</span><span class="p">[(</span><span class="n">lat</span> <span class="o">&gt;</span> <span class="n">ZC1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lat</span> <span class="o">&lt;</span> <span class="n">polar_boundary</span><span class="p">)],</span> \
                  <span class="n">lat</span><span class="p">[(</span><span class="n">lat</span> <span class="o">&gt;</span> <span class="n">ZC1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lat</span> <span class="o">&lt;</span> <span class="n">polar_boundary</span><span class="p">)],</span> <span class="n">lat_uncertainty</span><span class="o">=</span><span class="n">lat_uncertainty</span><span class="p">)</span>
  
  <span class="c1"># SH</span>
  <span class="c1"># flip arrays to find the most equatorward zero crossing</span>
  <span class="n">M1</span> <span class="o">=</span> <span class="n">TropD_Calculate_MaxLat</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="o">-</span><span class="n">pe</span><span class="p">[(</span><span class="n">lat</span> <span class="o">&lt;</span> <span class="o">-</span><span class="n">eq_boundary</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lat</span> <span class="o">&gt;</span> <span class="o">-</span><span class="n">subpolar_boundary</span><span class="p">)],</span><span class="mi">0</span><span class="p">),</span>\
                 <span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">lat</span><span class="p">[(</span><span class="n">lat</span> <span class="o">&lt;</span> <span class="o">-</span><span class="n">eq_boundary</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lat</span> <span class="o">&gt;</span> <span class="o">-</span><span class="n">subpolar_boundary</span><span class="p">)],</span><span class="mi">0</span><span class="p">),</span> <span class="n">n</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>               
  <span class="n">ZC1</span> <span class="o">=</span> <span class="n">TropD_Calculate_ZeroCrossing</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">pe</span><span class="p">[(</span><span class="n">lat</span> <span class="o">&lt;</span> <span class="n">M1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lat</span> <span class="o">&gt;</span> <span class="o">-</span><span class="n">polar_boundary</span><span class="p">)],</span><span class="mi">0</span><span class="p">),</span> \
                 <span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">lat</span><span class="p">[(</span><span class="n">lat</span> <span class="o">&lt;</span> <span class="n">M1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lat</span> <span class="o">&gt;</span> <span class="o">-</span><span class="n">polar_boundary</span><span class="p">)],</span><span class="mi">0</span><span class="p">),</span> <span class="n">lat_uncertainty</span><span class="o">=</span><span class="n">lat_uncertainty</span><span class="p">)</span>

  <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">ZC1</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">ped</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
    <span class="n">PhiSH</span> <span class="o">=</span> <span class="n">ZC1</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="n">PhiSH</span> <span class="o">=</span> <span class="n">TropD_Calculate_ZeroCrossing</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">pe</span><span class="p">[(</span><span class="n">lat</span> <span class="o">&lt;</span> <span class="n">ZC1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lat</span> <span class="o">&gt;</span> <span class="o">-</span><span class="n">polar_boundary</span><span class="p">)],</span><span class="mi">0</span><span class="p">),</span> \
                  <span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">lat</span><span class="p">[(</span><span class="n">lat</span> <span class="o">&lt;</span> <span class="n">ZC1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lat</span> <span class="o">&gt;</span> <span class="o">-</span><span class="n">polar_boundary</span><span class="p">)],</span><span class="mi">0</span><span class="p">),</span> <span class="n">lat_uncertainty</span><span class="o">=</span><span class="n">lat_uncertainty</span><span class="p">)</span>

  <span class="k">return</span> <span class="n">PhiSH</span><span class="p">,</span> <span class="n">PhiNH</span></div>

<div class="viewcode-block" id="TropD_Metric_PSI"><a class="viewcode-back" href="../reference.html#metrics.TropD_Metric_PSI">[docs]</a><span class="k">def</span> <span class="nf">TropD_Metric_PSI</span><span class="p">(</span><span class="n">V</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">lev</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;Psi_500&#39;</span><span class="p">,</span> <span class="n">lat_uncertainty</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
  <span class="sd">&#39;&#39;&#39; TropD Mass streamfunction (PSI) metric</span>

<span class="sd">      Latitude of the meridional mass streamfunction subtropical zero crossing</span>
<span class="sd">     </span>
<span class="sd">      Args:</span>
<span class="sd">  </span>
<span class="sd">        V(lat,lev): zonal-mean meridional wind</span>
<span class="sd">      </span>
<span class="sd">        lat: latitude vector</span>

<span class="sd">        lev: vertical level vector in hPa units</span>
<span class="sd">  </span>
<span class="sd">        method (str, optional):</span>
<span class="sd">  </span>
<span class="sd">          &#39;Psi_500&#39;(default): Zero crossing of the stream function (Psi) at the 500hPa level</span>

<span class="sd">          &#39;Psi_500_10Perc&#39;: Crossing of 10# of the extremum value of Psi in each hemisphre at the 500hPa level</span>

<span class="sd">          &#39;Psi_300_700&#39;: Zero crossing of Psi vertically averaged between the 300hPa and 700 hPa levels</span>

<span class="sd">          &#39;Psi_500_Int&#39;: Zero crossing of the vertically-integrated Psi at the 500 hPa level</span>

<span class="sd">          &#39;Psi_Int&#39;    : Zero crossing of the column-averaged Psi</span>
<span class="sd">    </span>
<span class="sd">        lat_uncertainty (float, optional): The minimal distance allowed between the first and second zero crossings. For example, for lat_uncertainty = 10, the function will return a NaN value if a second zero crossings is found within 10 degrees of the most equatorward zero crossing.   </span>
<span class="sd">  </span>
<span class="sd">      Returns:</span>

<span class="sd">        tuple: PhiSH (ndarray), PhiNH (ndarray) Latitude of Psi zero crossing in SH and NH</span>
<span class="sd">  </span>
<span class="sd">  &#39;&#39;&#39;</span>


  <span class="k">try</span><span class="p">:</span>
    <span class="k">assert</span> <span class="p">(</span><span class="n">lat_uncertainty</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span>  
  <span class="k">except</span> <span class="ne">AssertionError</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;TropD_Metric_PSI: ERROR : lat_uncertainty must be &gt;= 0&#39;</span><span class="p">)</span>
  
  <span class="k">try</span><span class="p">:</span>
    <span class="k">assert</span><span class="p">(</span><span class="n">method</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;Psi_500&#39;</span><span class="p">,</span><span class="s1">&#39;Psi_500_10Perc&#39;</span><span class="p">,</span><span class="s1">&#39;Psi_300_700&#39;</span><span class="p">,</span><span class="s1">&#39;Psi_500_Int&#39;</span><span class="p">,</span><span class="s1">&#39;Psi_Int&#39;</span><span class="p">])</span>
  <span class="k">except</span> <span class="ne">AssertionError</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;TropD_Metric_PSI: ERROR : unrecognized method &#39;</span><span class="p">,</span> <span class="n">method</span><span class="p">)</span>
    
  <span class="n">subpolar_boundary</span> <span class="o">=</span> <span class="mi">30</span>
  <span class="n">polar_boundary</span> <span class="o">=</span> <span class="mi">60</span>
    
  <span class="n">Psi</span> <span class="o">=</span> <span class="n">TropD_Calculate_StreamFunction</span><span class="p">(</span><span class="n">V</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">lev</span><span class="p">)</span>
  <span class="n">Psi</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">Psi</span><span class="p">)]</span><span class="o">=</span><span class="mi">0</span>
  <span class="c1"># make latitude vector monotonically increasing</span>
  <span class="k">if</span> <span class="n">lat</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">lat</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
      <span class="n">Psi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">Psi</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
      <span class="n">lat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">lat</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    
  <span class="n">COS</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">lat</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">180</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">lev</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lat</span><span class="p">),</span><span class="nb">len</span><span class="p">(</span><span class="n">lev</span><span class="p">))</span>
    
  <span class="k">if</span> <span class="p">(</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;Psi_500&#39;</span> <span class="ow">or</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;Psi_500_10Perc&#39;</span><span class="p">):</span>
    <span class="c1"># Use Psi at the level nearest to 500 hPa</span>
    <span class="n">P</span> <span class="o">=</span> <span class="n">Psi</span><span class="p">[:,</span><span class="n">find_nearest</span><span class="p">(</span><span class="n">lev</span><span class="p">,</span> <span class="mi">500</span><span class="p">)]</span>

  <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;Psi_300_700&#39;</span><span class="p">:</span>
    <span class="c1"># Use Psi averaged between the 300 and 700 hPa level</span>
    <span class="n">P</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">trapz</span><span class="p">(</span><span class="n">Psi</span><span class="p">[:,(</span><span class="n">lev</span> <span class="o">&lt;=</span> <span class="mi">700</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lev</span> <span class="o">&gt;=</span> <span class="mi">300</span><span class="p">)]</span> <span class="o">*</span> <span class="n">COS</span><span class="p">[:,(</span><span class="n">lev</span> <span class="o">&lt;=</span> <span class="mi">700</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lev</span> <span class="o">&gt;=</span> <span class="mi">300</span><span class="p">)],</span>\
                  <span class="n">lev</span><span class="p">[(</span><span class="n">lev</span> <span class="o">&lt;=</span> <span class="mi">700</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lev</span> <span class="o">&gt;=</span> <span class="mi">300</span><span class="p">)]</span><span class="o">*</span><span class="mi">100</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

  <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;Psi_500_Int&#39;</span><span class="p">:</span>
    <span class="c1"># Use integrated Psi from p=0 to level mearest to 500 hPa</span>
    <span class="n">PPsi_temp</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">integrate</span><span class="o">.</span><span class="n">cumtrapz</span><span class="p">(</span><span class="n">Psi</span><span class="o">*</span><span class="n">COS</span><span class="p">,</span> <span class="n">lev</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">PPsi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">Psi</span><span class="p">))</span>
    <span class="n">PPsi</span><span class="p">[:,</span><span class="mi">1</span><span class="p">:]</span> <span class="o">=</span> <span class="n">PPsi_temp</span>
    <span class="n">P</span> <span class="o">=</span> <span class="n">PPsi</span><span class="p">[:,</span><span class="n">find_nearest</span><span class="p">(</span><span class="n">lev</span><span class="p">,</span> <span class="mi">500</span><span class="p">)]</span>
     
  <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;Psi_Int&#39;</span><span class="p">:</span>
    <span class="c1"># Use vertical mean of Psi </span>
    <span class="n">P</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">trapz</span><span class="p">(</span><span class="n">Psi</span><span class="o">*</span><span class="n">COS</span><span class="p">,</span> <span class="n">lev</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
  
  <span class="k">else</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;TropD_Metric_PSI: ERROR : Unrecognized method &#39;</span><span class="p">,</span> <span class="n">method</span><span class="p">)</span>
  
    
  <span class="c1"># 1. Find latitude of maximal (minimal) tropical Psi in the NH (SH)</span>
  <span class="c1"># 2. Find latitude of minimal (maximal) subtropical Psi in the NH (SH)</span>
  <span class="c1"># 3. Find the zero crossing between the above latitudes</span>

  <span class="c1"># NH</span>
  <span class="n">Lmax</span> <span class="o">=</span> <span class="n">TropD_Calculate_MaxLat</span><span class="p">(</span><span class="n">P</span><span class="p">[(</span><span class="n">lat</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lat</span> <span class="o">&lt;</span> <span class="n">subpolar_boundary</span><span class="p">)],</span>\
                                <span class="n">lat</span><span class="p">[(</span><span class="n">lat</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lat</span> <span class="o">&lt;</span> <span class="n">subpolar_boundary</span><span class="p">)])</span>

  <span class="n">Lmin</span> <span class="o">=</span> <span class="n">TropD_Calculate_MaxLat</span><span class="p">(</span><span class="o">-</span><span class="n">P</span><span class="p">[(</span><span class="n">lat</span> <span class="o">&gt;</span> <span class="n">Lmax</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lat</span> <span class="o">&lt;</span> <span class="n">polar_boundary</span><span class="p">)],</span>\
                                <span class="n">lat</span><span class="p">[(</span><span class="n">lat</span> <span class="o">&gt;</span> <span class="n">Lmax</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lat</span> <span class="o">&lt;</span> <span class="n">polar_boundary</span><span class="p">)])</span>
  <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;Psi_500_10Perc&#39;</span><span class="p">:</span>
    <span class="n">Pmax</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">P</span><span class="p">[(</span><span class="n">lat</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lat</span> <span class="o">&lt;</span> <span class="n">subpolar_boundary</span><span class="p">)])</span>
    <span class="n">PhiNH</span> <span class="o">=</span> <span class="n">TropD_Calculate_ZeroCrossing</span><span class="p">(</span><span class="n">P</span><span class="p">[(</span><span class="n">lat</span> <span class="o">&gt;</span> <span class="n">Lmax</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lat</span> <span class="o">&lt;</span> <span class="n">Lmin</span><span class="p">)]</span> <span class="o">-</span> <span class="mf">0.1</span><span class="o">*</span><span class="n">Pmax</span><span class="p">,</span>\
            <span class="n">lat</span><span class="p">[(</span><span class="n">lat</span> <span class="o">&gt;</span> <span class="n">Lmax</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lat</span> <span class="o">&lt;</span> <span class="n">Lmin</span><span class="p">)])</span>

  <span class="k">else</span><span class="p">:</span>
    <span class="n">PhiNH</span> <span class="o">=</span> <span class="n">TropD_Calculate_ZeroCrossing</span><span class="p">(</span><span class="n">P</span><span class="p">[(</span><span class="n">lat</span> <span class="o">&gt;</span> <span class="n">Lmax</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lat</span> <span class="o">&lt;</span> <span class="n">Lmin</span><span class="p">)],</span>\
            <span class="n">lat</span><span class="p">[(</span><span class="n">lat</span> <span class="o">&gt;</span> <span class="n">Lmax</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lat</span> <span class="o">&lt;</span> <span class="n">Lmin</span><span class="p">)],</span> <span class="n">lat_uncertainty</span><span class="o">=</span><span class="n">lat_uncertainty</span><span class="p">)</span>
  
  <span class="c1"># SH</span>
  <span class="n">Lmax</span> <span class="o">=</span> <span class="n">TropD_Calculate_MaxLat</span><span class="p">(</span><span class="o">-</span><span class="n">P</span><span class="p">[(</span><span class="n">lat</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lat</span> <span class="o">&gt;</span> <span class="o">-</span><span class="n">subpolar_boundary</span><span class="p">)],</span>\
         <span class="n">lat</span><span class="p">[(</span><span class="n">lat</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lat</span> <span class="o">&gt;</span> <span class="o">-</span><span class="n">subpolar_boundary</span><span class="p">)])</span>

  <span class="n">Lmin</span> <span class="o">=</span> <span class="n">TropD_Calculate_MaxLat</span><span class="p">(</span><span class="n">P</span><span class="p">[(</span><span class="n">lat</span> <span class="o">&lt;</span> <span class="n">Lmax</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lat</span> <span class="o">&gt;</span> <span class="o">-</span><span class="n">polar_boundary</span><span class="p">)],</span>\
         <span class="n">lat</span><span class="p">[(</span><span class="n">lat</span> <span class="o">&lt;</span> <span class="n">Lmax</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lat</span> <span class="o">&gt;</span> <span class="o">-</span><span class="n">polar_boundary</span><span class="p">)])</span>

  <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;Psi_500_10Perc&#39;</span><span class="p">:</span>
    <span class="n">Pmin</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">P</span><span class="p">[(</span><span class="n">lat</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lat</span> <span class="o">&gt;</span> <span class="o">-</span><span class="n">subpolar_boundary</span><span class="p">)])</span>
    <span class="n">PhiSH</span> <span class="o">=</span> <span class="n">TropD_Calculate_ZeroCrossing</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">P</span><span class="p">[(</span><span class="n">lat</span> <span class="o">&lt;</span> <span class="n">Lmax</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lat</span> <span class="o">&gt;</span> <span class="n">Lmin</span><span class="p">)],</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.1</span><span class="o">*</span><span class="n">Pmin</span><span class="p">,</span>\
            <span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">lat</span><span class="p">[(</span><span class="n">lat</span> <span class="o">&lt;</span> <span class="n">Lmax</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lat</span> <span class="o">&gt;</span> <span class="n">Lmin</span><span class="p">)],</span> <span class="mi">0</span><span class="p">))</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="n">PhiSH</span> <span class="o">=</span> <span class="n">TropD_Calculate_ZeroCrossing</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">P</span><span class="p">[(</span><span class="n">lat</span> <span class="o">&lt;</span> <span class="n">Lmax</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lat</span> <span class="o">&gt;</span> <span class="n">Lmin</span><span class="p">)],</span> <span class="mi">0</span><span class="p">),</span>\
            <span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">lat</span><span class="p">[(</span><span class="n">lat</span> <span class="o">&lt;</span> <span class="n">Lmax</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lat</span> <span class="o">&gt;</span> <span class="n">Lmin</span><span class="p">)],</span> <span class="mi">0</span><span class="p">),</span> <span class="n">lat_uncertainty</span><span class="o">=</span><span class="n">lat_uncertainty</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">PhiSH</span><span class="p">,</span> <span class="n">PhiNH</span></div>

    
<div class="viewcode-block" id="TropD_Metric_PSL"><a class="viewcode-back" href="../reference.html#metrics.TropD_Metric_PSL">[docs]</a><span class="k">def</span> <span class="nf">TropD_Metric_PSL</span><span class="p">(</span><span class="n">ps</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;peak&#39;</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>

  <span class="sd">&#39;&#39;&#39; TropD Sea-level pressure (PSL) metric</span>

<span class="sd">      Latitude of maximum of the subtropical sea-level pressure</span>
<span class="sd">  </span>
<span class="sd">      Args:</span>
<span class="sd">  </span>
<span class="sd">        ps(lat,): sea-level pressure</span>
<span class="sd">      </span>
<span class="sd">        lat: equally spaced latitude column vector</span>

<span class="sd">        method (str, optional): &#39;peak&#39; (default) | &#39;max&#39;</span>
<span class="sd">  </span>
<span class="sd">      Returns:</span>

<span class="sd">        tuple: PhiSH (ndarray), PhiNH (ndarray) Latitude of subtropical sea-level pressure maximum SH and NH</span>

<span class="sd">  &#39;&#39;&#39;</span>
  <span class="k">try</span><span class="p">:</span>
    <span class="k">assert</span><span class="p">(</span><span class="n">method</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;max&#39;</span><span class="p">,</span><span class="s1">&#39;peak&#39;</span><span class="p">])</span>
  <span class="k">except</span> <span class="ne">AssertionError</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;TropD_Metric_PSL: ERROR : unrecognized method &#39;</span><span class="p">,</span> <span class="n">method</span><span class="p">)</span>

  <span class="k">try</span><span class="p">:</span>
    <span class="k">assert</span> <span class="p">(</span><span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="s2">&quot;__len__&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">n</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span>  
  <span class="k">except</span> <span class="ne">AssertionError</span><span class="p">:</span>
    <span class="k">print</span> <span class="s1">&#39;TropD_Metric_PSL: ERROR : the smoothing parameter n must be &gt;= 0&#39;</span>

  <span class="n">eq_boundary</span> <span class="o">=</span> <span class="mi">15</span>
  <span class="n">polar_boundary</span> <span class="o">=</span> <span class="mi">60</span>
    
  <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;max&#39;</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">n</span><span class="p">:</span>
      <span class="n">PhiNH</span> <span class="o">=</span> <span class="n">TropD_Calculate_MaxLat</span><span class="p">(</span><span class="n">ps</span><span class="p">[(</span><span class="n">lat</span> <span class="o">&gt;</span> <span class="n">eq_boundary</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lat</span> <span class="o">&lt;</span> <span class="n">polar_boundary</span><span class="p">)],</span>\
             <span class="n">lat</span><span class="p">[(</span><span class="n">lat</span> <span class="o">&gt;</span> <span class="n">eq_boundary</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lat</span> <span class="o">&lt;</span> <span class="n">polar_boundary</span><span class="p">)],</span><span class="n">n</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>
      <span class="n">PhiSH</span> <span class="o">=</span> <span class="n">TropD_Calculate_MaxLat</span><span class="p">(</span><span class="n">ps</span><span class="p">[(</span><span class="n">lat</span> <span class="o">&gt;</span> <span class="o">-</span><span class="n">polar_boundary</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lat</span> <span class="o">&lt;</span> <span class="o">-</span><span class="n">eq_boundary</span><span class="p">)],</span>\
              <span class="n">lat</span><span class="p">[(</span><span class="n">lat</span> <span class="o">&gt;</span> <span class="o">-</span><span class="n">polar_boundary</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lat</span> <span class="o">&lt;</span> <span class="o">-</span><span class="n">eq_boundary</span><span class="p">)],</span> <span class="n">n</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">PhiNH</span> <span class="o">=</span> <span class="n">TropD_Calculate_MaxLat</span><span class="p">(</span><span class="n">ps</span><span class="p">[(</span><span class="n">lat</span> <span class="o">&gt;</span> <span class="n">eq_boundary</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lat</span> <span class="o">&lt;</span> <span class="n">polar_boundary</span><span class="p">)],</span>\
              <span class="n">lat</span><span class="p">[(</span><span class="n">lat</span> <span class="o">&gt;</span> <span class="n">eq_boundary</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lat</span> <span class="o">&lt;</span> <span class="n">polar_boundary</span><span class="p">)])</span>
      <span class="n">PhiSH</span> <span class="o">=</span> <span class="n">TropD_Calculate_MaxLat</span><span class="p">(</span><span class="n">ps</span><span class="p">[(</span><span class="n">lat</span> <span class="o">&gt;</span> <span class="o">-</span><span class="n">polar_boundary</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lat</span> <span class="o">&lt;</span> <span class="o">-</span><span class="n">eq_boundary</span><span class="p">)],</span>\
              <span class="n">lat</span><span class="p">[(</span><span class="n">lat</span> <span class="o">&gt;</span> <span class="o">-</span><span class="n">polar_boundary</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lat</span> <span class="o">&lt;</span> <span class="o">-</span><span class="n">eq_boundary</span><span class="p">)])</span>

  <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;peak&#39;</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">n</span><span class="p">:</span>
      <span class="n">PhiNH</span> <span class="o">=</span> <span class="n">TropD_Calculate_MaxLat</span><span class="p">(</span><span class="n">ps</span><span class="p">[(</span><span class="n">lat</span> <span class="o">&gt;</span> <span class="n">eq_boundary</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lat</span> <span class="o">&lt;</span> <span class="n">polar_boundary</span><span class="p">)],</span>\
              <span class="n">lat</span><span class="p">[(</span><span class="n">lat</span> <span class="o">&gt;</span> <span class="n">eq_boundary</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lat</span> <span class="o">&lt;</span> <span class="n">polar_boundary</span><span class="p">)],</span> <span class="n">n</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>
      <span class="n">PhiSH</span> <span class="o">=</span> <span class="n">TropD_Calculate_MaxLat</span><span class="p">(</span><span class="n">ps</span><span class="p">[(</span><span class="n">lat</span> <span class="o">&gt;</span> <span class="o">-</span><span class="n">polar_boundary</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lat</span> <span class="o">&lt;</span> <span class="o">-</span><span class="n">eq_boundary</span><span class="p">)],</span>\
              <span class="n">lat</span><span class="p">[(</span><span class="n">lat</span> <span class="o">&gt;</span> <span class="o">-</span><span class="n">polar_boundary</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lat</span> <span class="o">&lt;</span> <span class="o">-</span><span class="n">eq_boundary</span><span class="p">)],</span> <span class="n">n</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">PhiNH</span> <span class="o">=</span> <span class="n">TropD_Calculate_MaxLat</span><span class="p">(</span><span class="n">ps</span><span class="p">[(</span><span class="n">lat</span> <span class="o">&gt;</span> <span class="n">eq_boundary</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lat</span> <span class="o">&lt;</span> <span class="n">polar_boundary</span><span class="p">)],</span>\
              <span class="n">lat</span><span class="p">[(</span><span class="n">lat</span> <span class="o">&gt;</span> <span class="n">eq_boundary</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lat</span> <span class="o">&lt;</span> <span class="n">polar_boundary</span><span class="p">)],</span> <span class="n">n</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
      <span class="n">PhiSH</span> <span class="o">=</span> <span class="n">TropD_Calculate_MaxLat</span><span class="p">(</span><span class="n">ps</span><span class="p">[(</span><span class="n">lat</span> <span class="o">&gt;</span> <span class="o">-</span><span class="n">polar_boundary</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lat</span> <span class="o">&lt;</span> <span class="o">-</span><span class="n">eq_boundary</span><span class="p">)],</span>\
              <span class="n">lat</span><span class="p">[(</span><span class="n">lat</span> <span class="o">&gt;</span> <span class="o">-</span><span class="n">polar_boundary</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lat</span> <span class="o">&lt;</span> <span class="o">-</span><span class="n">eq_boundary</span><span class="p">)],</span> <span class="n">n</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;TropD_Metric_PSL: ERROR: unrecognized method &#39;</span><span class="p">,</span> <span class="n">method</span><span class="p">)</span>
  
  <span class="k">return</span> <span class="n">PhiSH</span><span class="p">,</span> <span class="n">PhiNH</span></div>
    

<div class="viewcode-block" id="TropD_Metric_STJ"><a class="viewcode-back" href="../reference.html#metrics.TropD_Metric_STJ">[docs]</a><span class="k">def</span> <span class="nf">TropD_Metric_STJ</span><span class="p">(</span><span class="n">U</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">lev</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;adjusted_peak&#39;</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>

  <span class="sd">&#39;&#39;&#39; TropD Subtropical Jet (STJ) metric</span>
<span class="sd">  </span>
<span class="sd">      Args:</span>
<span class="sd">  </span>
<span class="sd">        U(lat,lev): zonal mean zonal wind</span>

<span class="sd">        lat: latitude vector</span>
<span class="sd">      </span>
<span class="sd">        lev: vertical level vector in hPa units</span>
<span class="sd">  </span>
<span class="sd">        method (str, optional): </span>

<span class="sd">          &#39;adjusted_peak&#39;: Latitude of maximum (smoothing parameter n=30) of the zonal wind averaged between the 100 and 400 hPa levels minus the zonal mean zonal wind at the level closes to the 850 hPa level, poleward of 10 degrees and equatorward of the Eddy Driven Jet latitude</span>
<span class="sd">          </span>
<span class="sd">	  &#39;adjusted_max&#39; : Latitude of maximum (smoothing parameter n=6) of the zonal wind averaged between the 100 and 400 hPa levels minus the zonal mean zonal wind at the level closes to the 850 hPa level, poleward of 10 degrees and equatorward of the Eddy Driven Jet latitude</span>

<span class="sd">          &#39;core_peak&#39;: Latitude of maximum of the zonal wind (smoothing parameter n=30) averaged between the 100 and 400 hPa levels, poleward of 10 degrees and equatorward of 70 degrees</span>
<span class="sd">          </span>
<span class="sd">	  &#39;core_max&#39;: Latitude of maximum of the zonal wind (smoothing parameter n=6) averaged between the 100 and 400 hPa levels, poleward of 10 degrees and equatorward of 70 degrees</span>
<span class="sd">    </span>
<span class="sd">      Returns:</span>

<span class="sd">        tuple: PhiSH (ndarray), PhiNH (ndarray) Latitude of STJ SH and NH</span>

<span class="sd">  &#39;&#39;&#39;</span>

  <span class="k">try</span><span class="p">:</span>
    <span class="k">assert</span> <span class="p">(</span><span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="s2">&quot;__len__&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">n</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span>  
  <span class="k">except</span> <span class="ne">AssertionError</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;TropD_Metric_STJ: ERROR : the smoothing parameter n must be &gt;= 0&#39;</span><span class="p">)</span>
  
  <span class="k">try</span><span class="p">:</span>
    <span class="k">assert</span><span class="p">(</span><span class="n">method</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;adjusted_peak&#39;</span><span class="p">,</span><span class="s1">&#39;core_peak&#39;</span><span class="p">,</span><span class="s1">&#39;adjusted_max&#39;</span><span class="p">,</span><span class="s1">&#39;core_max&#39;</span><span class="p">])</span>
  <span class="k">except</span> <span class="ne">AssertionError</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;TropD_Metric_STJ: ERROR : unrecognized method &#39;</span><span class="p">,</span> <span class="n">method</span><span class="p">)</span>

  <span class="n">eq_boundary</span> <span class="o">=</span> <span class="mi">10</span>
  <span class="n">polar_boundary</span> <span class="o">=</span> <span class="mi">60</span>

  <span class="n">lev_int</span> <span class="o">=</span> <span class="n">lev</span><span class="p">[(</span><span class="n">lev</span> <span class="o">&gt;=</span> <span class="mi">100</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lev</span> <span class="o">&lt;=</span> <span class="mi">400</span><span class="p">)]</span>

  <span class="k">if</span> <span class="p">(</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;adjusted_peak&#39;</span> <span class="ow">or</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;adjusted_max&#39;</span><span class="p">):</span> 
    <span class="n">idx_850</span> <span class="o">=</span> <span class="n">find_nearest</span><span class="p">(</span><span class="n">lev</span><span class="p">,</span> <span class="mi">850</span><span class="p">)</span>

    <span class="c1"># Pressure weighted vertical mean of U minus near surface U</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lev_int</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
      <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">trapz</span><span class="p">(</span><span class="n">U</span><span class="p">[:,</span> <span class="p">(</span><span class="n">lev</span> <span class="o">&gt;=</span> <span class="mi">100</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lev</span> <span class="o">&lt;=</span> <span class="mi">400</span><span class="p">)],</span> <span class="n">lev_int</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> \
          <span class="o">/</span> <span class="p">(</span><span class="n">lev_int</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">lev_int</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">-</span> <span class="n">U</span><span class="p">[:,</span><span class="n">idx_850</span><span class="p">]</span>

    <span class="k">else</span><span class="p">:</span>
      <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">U</span><span class="p">[:,(</span><span class="n">lev</span> <span class="o">&gt;=</span> <span class="mi">100</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lev</span> <span class="o">&lt;=</span> <span class="mi">400</span><span class="p">)],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">U</span><span class="p">[:,</span><span class="n">idx_850</span><span class="p">]</span>

  <span class="k">elif</span> <span class="p">(</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;core_peak&#39;</span> <span class="ow">or</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;core_max&#39;</span><span class="p">):</span>
    <span class="c1"># Pressure weighted vertical mean of U</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lev_int</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
      <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">trapz</span><span class="p">(</span><span class="n">U</span><span class="p">[:,</span> <span class="p">(</span><span class="n">lev</span> <span class="o">&gt;=</span> <span class="mi">100</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lev</span> <span class="o">&lt;=</span> <span class="mi">400</span><span class="p">)],</span> <span class="n">lev_int</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> \
          <span class="o">/</span> <span class="p">(</span><span class="n">lev_int</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">lev_int</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

    <span class="k">else</span><span class="p">:</span>
      <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">U</span><span class="p">[:,</span> <span class="p">(</span><span class="n">lev</span> <span class="o">&gt;=</span> <span class="mi">100</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lev</span> <span class="o">&lt;=</span> <span class="mi">400</span><span class="p">)],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

  <span class="k">else</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;TropD_Metric_STJ: unrecognized method &#39;</span><span class="p">,</span> <span class="n">method</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;TropD_Metric_STJ: optional methods are: adjusted_peak (default), adjusted_max, core_peak, core_max&#39;</span><span class="p">)</span>

  <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;core_peak&#39;</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">n</span><span class="p">:</span>
      <span class="n">PhiNH</span> <span class="o">=</span> <span class="n">TropD_Calculate_MaxLat</span><span class="p">(</span><span class="n">u</span><span class="p">[(</span><span class="n">lat</span> <span class="o">&gt;</span> <span class="n">eq_boundary</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lat</span> <span class="o">&lt;</span> <span class="n">polar_boundary</span><span class="p">)],</span>\
          <span class="n">lat</span><span class="p">[(</span><span class="n">lat</span> <span class="o">&gt;</span> <span class="n">eq_boundary</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lat</span> <span class="o">&lt;</span> <span class="n">polar_boundary</span><span class="p">)],</span> <span class="n">n</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>
      <span class="n">PhiSH</span> <span class="o">=</span> <span class="n">TropD_Calculate_MaxLat</span><span class="p">(</span><span class="n">u</span><span class="p">[(</span><span class="n">lat</span> <span class="o">&gt;</span> <span class="o">-</span><span class="n">polar_boundary</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lat</span> <span class="o">&lt;</span> <span class="o">-</span><span class="n">eq_boundary</span><span class="p">)],</span>\
          <span class="n">lat</span><span class="p">[(</span><span class="n">lat</span> <span class="o">&gt;</span> <span class="o">-</span><span class="n">polar_boundary</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lat</span> <span class="o">&lt;</span> <span class="o">-</span><span class="n">eq_boundary</span><span class="p">)],</span> <span class="n">n</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">PhiNH</span> <span class="o">=</span> <span class="n">TropD_Calculate_MaxLat</span><span class="p">(</span><span class="n">u</span><span class="p">[(</span><span class="n">lat</span> <span class="o">&gt;</span> <span class="n">eq_boundary</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lat</span> <span class="o">&lt;</span> <span class="n">polar_boundary</span><span class="p">)],</span>\
          <span class="n">lat</span><span class="p">[(</span><span class="n">lat</span> <span class="o">&gt;</span> <span class="n">eq_boundary</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lat</span> <span class="o">&lt;</span> <span class="n">polar_boundary</span><span class="p">)],</span><span class="n">n</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
      <span class="n">PhiSH</span> <span class="o">=</span> <span class="n">TropD_Calculate_MaxLat</span><span class="p">(</span><span class="n">u</span><span class="p">[(</span><span class="n">lat</span> <span class="o">&gt;</span> <span class="o">-</span><span class="n">polar_boundary</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lat</span> <span class="o">&lt;</span> <span class="o">-</span><span class="n">eq_boundary</span><span class="p">)],</span>\
          <span class="n">lat</span><span class="p">[(</span><span class="n">lat</span> <span class="o">&gt;</span> <span class="o">-</span><span class="n">polar_boundary</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lat</span> <span class="o">&lt;</span> <span class="o">-</span><span class="n">eq_boundary</span><span class="p">)],</span> <span class="n">n</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>

  <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;core_max&#39;</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">n</span><span class="p">:</span>
      <span class="n">PhiNH</span> <span class="o">=</span> <span class="n">TropD_Calculate_MaxLat</span><span class="p">(</span><span class="n">u</span><span class="p">[(</span><span class="n">lat</span> <span class="o">&gt;</span> <span class="n">eq_boundary</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lat</span> <span class="o">&lt;</span> <span class="n">polar_boundary</span><span class="p">)],</span>\
          <span class="n">lat</span><span class="p">[(</span><span class="n">lat</span> <span class="o">&gt;</span> <span class="n">eq_boundary</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lat</span> <span class="o">&lt;</span> <span class="n">polar_boundary</span><span class="p">)],</span> <span class="n">n</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>
      <span class="n">PhiSH</span> <span class="o">=</span> <span class="n">TropD_Calculate_MaxLat</span><span class="p">(</span><span class="n">u</span><span class="p">[(</span><span class="n">lat</span> <span class="o">&gt;</span> <span class="o">-</span><span class="n">polar_boundary</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lat</span> <span class="o">&lt;</span> <span class="o">-</span> <span class="n">eq_boundary</span><span class="p">)],</span>\
          <span class="n">lat</span><span class="p">[(</span><span class="n">lat</span> <span class="o">&gt;</span> <span class="o">-</span><span class="n">polar_boundary</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lat</span> <span class="o">&lt;</span> <span class="o">-</span><span class="n">eq_boundary</span><span class="p">)],</span> <span class="n">n</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">PhiNH</span> <span class="o">=</span> <span class="n">TropD_Calculate_MaxLat</span><span class="p">(</span><span class="n">u</span><span class="p">[(</span><span class="n">lat</span> <span class="o">&gt;</span> <span class="n">eq_boundary</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lat</span> <span class="o">&lt;</span> <span class="n">polar_boundary</span><span class="p">)],</span>\
          <span class="n">lat</span><span class="p">[(</span><span class="n">lat</span> <span class="o">&gt;</span> <span class="n">eq_boundary</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lat</span> <span class="o">&lt;</span> <span class="n">polar_boundary</span><span class="p">)],</span> <span class="n">n</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>
      <span class="n">PhiSH</span> <span class="o">=</span> <span class="n">TropD_Calculate_MaxLat</span><span class="p">(</span><span class="n">u</span><span class="p">[(</span><span class="n">lat</span> <span class="o">&gt;</span> <span class="o">-</span><span class="n">polar_boundary</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lat</span> <span class="o">&lt;</span> <span class="o">-</span><span class="n">eq_boundary</span><span class="p">)],</span>\
          <span class="n">lat</span><span class="p">[(</span><span class="n">lat</span> <span class="o">&gt;</span> <span class="o">-</span><span class="n">polar_boundary</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lat</span> <span class="o">&lt;</span> <span class="o">-</span><span class="n">eq_boundary</span><span class="p">)],</span> <span class="n">n</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>

  <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;adjusted_peak&#39;</span><span class="p">:</span>
    <span class="n">PhiSH_EDJ</span><span class="p">,</span> <span class="n">PhiNH_EDJ</span> <span class="o">=</span> <span class="n">TropD_Metric_EDJ</span><span class="p">(</span><span class="n">U</span><span class="p">,</span><span class="n">lat</span><span class="p">,</span><span class="n">lev</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">n</span><span class="p">:</span>
      <span class="n">PhiNH</span> <span class="o">=</span> <span class="n">TropD_Calculate_MaxLat</span><span class="p">(</span><span class="n">u</span><span class="p">[(</span><span class="n">lat</span> <span class="o">&gt;</span> <span class="n">eq_boundary</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lat</span> <span class="o">&lt;</span> <span class="n">PhiNH_EDJ</span><span class="p">)],</span>\
          <span class="n">lat</span><span class="p">[(</span><span class="n">lat</span> <span class="o">&gt;</span> <span class="n">eq_boundary</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lat</span> <span class="o">&lt;</span> <span class="n">PhiNH_EDJ</span><span class="p">)],</span> <span class="n">n</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>
      <span class="n">PhiSH</span> <span class="o">=</span> <span class="n">TropD_Calculate_MaxLat</span><span class="p">(</span><span class="n">u</span><span class="p">[(</span><span class="n">lat</span> <span class="o">&gt;</span> <span class="n">PhiSH_EDJ</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lat</span> <span class="o">&lt;</span> <span class="o">-</span><span class="n">eq_boundary</span><span class="p">)],</span>\
          <span class="n">lat</span><span class="p">[(</span><span class="n">lat</span> <span class="o">&gt;</span> <span class="n">PhiSH_EDJ</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lat</span> <span class="o">&lt;</span> <span class="o">-</span><span class="n">eq_boundary</span><span class="p">)],</span> <span class="n">n</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
      <span class="n">PhiNH</span> <span class="o">=</span> <span class="n">TropD_Calculate_MaxLat</span><span class="p">(</span><span class="n">u</span><span class="p">[(</span><span class="n">lat</span> <span class="o">&gt;</span> <span class="n">eq_boundary</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lat</span> <span class="o">&lt;</span> <span class="n">PhiNH_EDJ</span><span class="p">)],</span>\
          <span class="n">lat</span><span class="p">[(</span><span class="n">lat</span> <span class="o">&gt;</span> <span class="n">eq_boundary</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lat</span> <span class="o">&lt;</span> <span class="n">PhiNH_EDJ</span><span class="p">)],</span> <span class="n">n</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
      <span class="n">PhiSH</span> <span class="o">=</span> <span class="n">TropD_Calculate_MaxLat</span><span class="p">(</span><span class="n">u</span><span class="p">[(</span><span class="n">lat</span> <span class="o">&gt;</span> <span class="n">PhiSH_EDJ</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lat</span> <span class="o">&lt;</span> <span class="o">-</span><span class="n">eq_boundary</span><span class="p">)],</span>\
          <span class="n">lat</span><span class="p">[(</span><span class="n">lat</span> <span class="o">&gt;</span> <span class="n">PhiSH_EDJ</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lat</span> <span class="o">&lt;</span> <span class="o">-</span><span class="n">eq_boundary</span><span class="p">)],</span> <span class="n">n</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>

  <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;adjusted_max&#39;</span><span class="p">:</span>
    <span class="n">PhiSH_EDJ</span><span class="p">,</span><span class="n">PhiNH_EDJ</span> <span class="o">=</span> <span class="n">TropD_Metric_EDJ</span><span class="p">(</span><span class="n">U</span><span class="p">,</span><span class="n">lat</span><span class="p">,</span><span class="n">lev</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">n</span><span class="p">:</span>
      <span class="n">PhiNH</span> <span class="o">=</span> <span class="n">TropD_Calculate_MaxLat</span><span class="p">(</span><span class="n">u</span><span class="p">[(</span><span class="n">lat</span> <span class="o">&gt;</span> <span class="n">eq_boundary</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lat</span> <span class="o">&lt;</span> <span class="n">PhiNH_EDJ</span><span class="p">)],</span>\
          <span class="n">lat</span><span class="p">[(</span><span class="n">lat</span> <span class="o">&gt;</span> <span class="n">eq_boundary</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lat</span> <span class="o">&lt;</span> <span class="n">PhiNH_EDJ</span><span class="p">)],</span> <span class="n">n</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>
      <span class="n">PhiSH</span> <span class="o">=</span> <span class="n">TropD_Calculate_MaxLat</span><span class="p">(</span><span class="n">u</span><span class="p">[(</span><span class="n">lat</span> <span class="o">&gt;</span> <span class="n">PhiSH_EDJ</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lat</span> <span class="o">&lt;</span> <span class="o">-</span><span class="n">eq_boundary</span><span class="p">)],</span>\
          <span class="n">lat</span><span class="p">[(</span><span class="n">lat</span> <span class="o">&gt;</span> <span class="n">PhiSH_EDJ</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lat</span> <span class="o">&lt;</span> <span class="o">-</span><span class="n">eq_boundary</span><span class="p">)],</span> <span class="n">n</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">PhiNH</span> <span class="o">=</span> <span class="n">TropD_Calculate_MaxLat</span><span class="p">(</span><span class="n">u</span><span class="p">[(</span><span class="n">lat</span> <span class="o">&gt;</span> <span class="n">eq_boundary</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lat</span> <span class="o">&lt;</span> <span class="n">PhiNH_EDJ</span><span class="p">)],</span>\
          <span class="n">lat</span><span class="p">[(</span><span class="n">lat</span> <span class="o">&gt;</span> <span class="n">eq_boundary</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lat</span> <span class="o">&lt;</span> <span class="n">PhiNH_EDJ</span><span class="p">)],</span> <span class="n">n</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>
      <span class="n">PhiSH</span> <span class="o">=</span> <span class="n">TropD_Calculate_MaxLat</span><span class="p">(</span><span class="n">u</span><span class="p">[(</span><span class="n">lat</span> <span class="o">&gt;</span> <span class="n">PhiSH_EDJ</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lat</span> <span class="o">&lt;</span> <span class="o">-</span><span class="n">eq_boundary</span><span class="p">)],</span>\
          <span class="n">lat</span><span class="p">[(</span><span class="n">lat</span> <span class="o">&gt;</span> <span class="n">PhiSH_EDJ</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lat</span> <span class="o">&lt;</span> <span class="o">-</span><span class="n">eq_boundary</span><span class="p">)],</span> <span class="n">n</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>

  <span class="k">return</span> <span class="n">PhiSH</span><span class="p">,</span> <span class="n">PhiNH</span>    </div>

<div class="viewcode-block" id="TropD_Metric_TPB"><a class="viewcode-back" href="../reference.html#metrics.TropD_Metric_TPB">[docs]</a><span class="k">def</span> <span class="nf">TropD_Metric_TPB</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">lev</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;max_gradient&#39;</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">Z</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">Cutoff</span><span class="o">=</span><span class="mi">15</span><span class="o">*</span><span class="mi">1000</span><span class="p">):</span>

  <span class="sd">&#39;&#39;&#39; TropD Tropopause break (TPB) metric</span>
<span class="sd">  </span>
<span class="sd">      Args:</span>

<span class="sd">        T(lat,lev): temperature (K)</span>

<span class="sd">        lat: latitude vector</span>

<span class="sd">        lev: pressure levels column vector in hPa</span>

<span class="sd">        method (str, optional): </span>
<span class="sd">  </span>
<span class="sd">          &#39;max_gradient&#39; (default): The latitude of maximal poleward gradient of the tropopause height</span>
<span class="sd">  </span>
<span class="sd">          &#39;cutoff&#39;: The most equatorward latitude where the tropopause crosses a prescribed cutoff value</span>
<span class="sd">  </span>
<span class="sd">          &#39;max_potemp&#39;: The latitude of maximal difference between the potential temperature at the tropopause and at the surface</span>
<span class="sd">  </span>
<span class="sd">        Z(lat,lev) (optional): geopotential height (m)</span>

<span class="sd">        Cutoff (float, optional): geopotential height (m) cutoff that marks the location of the tropopause break</span>

<span class="sd">      Returns:</span>
<span class="sd">        tuple: PhiSH (ndarray), PhiNH (ndarray) Latitude of tropopause break SH and NH</span>

<span class="sd">  &#39;&#39;&#39;</span>


  <span class="n">Rd</span> <span class="o">=</span> <span class="mf">287.04</span>
  <span class="n">Cpd</span> <span class="o">=</span> <span class="mf">1005.7</span>
  <span class="n">k</span> <span class="o">=</span> <span class="n">Rd</span> <span class="o">/</span> <span class="n">Cpd</span>
  <span class="k">try</span><span class="p">:</span>
    <span class="k">assert</span> <span class="p">(</span><span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="s2">&quot;__len__&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">n</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span>  
  <span class="k">except</span> <span class="ne">AssertionError</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;TropD_Metric_TPB: ERROR : the smoothing parameter n must be &gt;= 0&#39;</span><span class="p">)</span>

  <span class="k">try</span><span class="p">:</span>
    <span class="k">assert</span><span class="p">(</span><span class="n">method</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;max_gradient&#39;</span><span class="p">,</span><span class="s1">&#39;max_potemp&#39;</span><span class="p">,</span><span class="s1">&#39;cutoff&#39;</span><span class="p">])</span>
  <span class="k">except</span> <span class="ne">AssertionError</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;TropD_Metric_TPB: ERROR : unrecognized method &#39;</span><span class="p">,</span> <span class="n">method</span><span class="p">)</span>
  
  <span class="n">polar_boundary</span> <span class="o">=</span> <span class="mi">60</span>

  <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;max_gradient&#39;</span><span class="p">:</span>
    <span class="n">Pt</span> <span class="o">=</span> <span class="n">TropD_Calculate_TropopauseHeight</span><span class="p">(</span><span class="n">T</span><span class="p">,</span><span class="n">lev</span><span class="p">)</span>
    <span class="n">Ptd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">Pt</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">lat</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">lat</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">lat2</span> <span class="o">=</span> <span class="p">(</span><span class="n">lat</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">+</span> <span class="n">lat</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="mi">2</span>
    
    <span class="k">if</span> <span class="p">(</span><span class="n">n</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">):</span>
      <span class="n">PhiNH</span> <span class="o">=</span> <span class="n">TropD_Calculate_MaxLat</span><span class="p">(</span><span class="n">Ptd</span><span class="p">[:,(</span><span class="n">lat2</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lat2</span> <span class="o">&lt;</span> <span class="n">polar_boundary</span><span class="p">)],</span>\
              <span class="n">lat2</span><span class="p">[(</span><span class="n">lat2</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lat2</span> <span class="o">&lt;</span> <span class="n">polar_boundary</span><span class="p">)],</span> <span class="n">n</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>
      <span class="n">PhiSH</span> <span class="o">=</span> <span class="n">TropD_Calculate_MaxLat</span><span class="p">(</span><span class="o">-</span><span class="n">Ptd</span><span class="p">[:,(</span><span class="n">lat2</span> <span class="o">&gt;</span> <span class="o">-</span><span class="n">polar_boundary</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lat2</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)],</span>\
              <span class="n">lat2</span><span class="p">[(</span><span class="n">lat2</span> <span class="o">&gt;</span> <span class="o">-</span><span class="n">polar_boundary</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lat2</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)],</span> <span class="n">n</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>
    
    <span class="k">else</span><span class="p">:</span>
      <span class="n">PhiNH</span> <span class="o">=</span> <span class="n">TropD_Calculate_MaxLat</span><span class="p">(</span><span class="n">Ptd</span><span class="p">[:,(</span><span class="n">lat2</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lat2</span> <span class="o">&lt;</span> <span class="n">polar_boundary</span><span class="p">)],</span>\
              <span class="n">lat2</span><span class="p">[(</span><span class="n">lat2</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lat2</span> <span class="o">&lt;</span> <span class="n">polar_boundary</span><span class="p">)])</span>
      <span class="n">PhiSH</span> <span class="o">=</span> <span class="n">TropD_Calculate_MaxLat</span><span class="p">(</span><span class="o">-</span><span class="n">Ptd</span><span class="p">[:,(</span><span class="n">lat2</span> <span class="o">&gt;</span> <span class="o">-</span><span class="n">polar_boundary</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lat2</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)],</span>\
              <span class="n">lat2</span><span class="p">[(</span><span class="n">lat2</span> <span class="o">&gt;</span> <span class="o">-</span><span class="n">polar_boundary</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lat2</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)])</span>
     
  <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;max_potemp&#39;</span><span class="p">:</span>
    <span class="n">XF</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">((</span><span class="n">lev</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">)</span> <span class="o">**</span> <span class="n">k</span><span class="p">,</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lat</span><span class="p">),</span> <span class="mi">1</span><span class="p">))</span>
    <span class="n">PT</span> <span class="o">=</span> <span class="n">T</span> <span class="o">/</span> <span class="n">XF</span>
    <span class="n">Pt</span><span class="p">,</span> <span class="n">PTt</span> <span class="o">=</span> <span class="n">TropD_Calculate_TropopauseHeight</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="n">lev</span><span class="p">,</span> <span class="n">Z</span><span class="o">=</span><span class="n">PT</span><span class="p">)</span>
    <span class="n">PTdif</span> <span class="o">=</span> <span class="n">PTt</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">PT</span><span class="p">,</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">n</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">):</span>
      <span class="n">PhiNH</span> <span class="o">=</span> <span class="n">TropD_Calculate_MaxLat</span><span class="p">(</span><span class="n">PTdif</span><span class="p">[:,(</span><span class="n">lat</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lat</span> <span class="o">&lt;</span> <span class="n">polar_boundary</span><span class="p">)],</span>\
              <span class="n">lat</span><span class="p">[(</span><span class="n">lat</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lat</span> <span class="o">&lt;</span> <span class="n">polar_boundary</span><span class="p">)],</span> <span class="n">n</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>
      <span class="n">PhiSH</span> <span class="o">=</span> <span class="n">TropD_Calculate_MaxLat</span><span class="p">(</span><span class="n">PTdif</span><span class="p">[:,(</span><span class="n">lat</span> <span class="o">&gt;</span> <span class="o">-</span> <span class="n">polar_boundary</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lat</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)],</span>\
              <span class="n">lat</span><span class="p">[(</span><span class="n">lat</span> <span class="o">&gt;</span> <span class="o">-</span><span class="n">polar_boundary</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lat</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)],</span> <span class="n">n</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>
    
    <span class="k">else</span><span class="p">:</span>
      <span class="n">PhiNH</span> <span class="o">=</span> <span class="n">TropD_Calculate_MaxLat</span><span class="p">(</span><span class="n">PTdif</span><span class="p">[:,(</span><span class="n">lat</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lat</span> <span class="o">&lt;</span> <span class="n">polar_boundary</span><span class="p">)],</span>\
              <span class="n">lat</span><span class="p">[(</span><span class="n">lat</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lat</span> <span class="o">&lt;</span> <span class="n">polar_boundary</span><span class="p">)],</span> <span class="n">n</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
      <span class="n">PhiSH</span> <span class="o">=</span> <span class="n">TropD_Calculate_MaxLat</span><span class="p">(</span><span class="n">PTdif</span><span class="p">[:,(</span><span class="n">lat</span> <span class="o">&gt;</span> <span class="o">-</span> <span class="n">polar_boundary</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lat</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)],</span>\
              <span class="n">lat</span><span class="p">[(</span><span class="n">lat</span> <span class="o">&gt;</span> <span class="o">-</span><span class="n">polar_boundary</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lat</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)],</span> <span class="n">n</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
   
  <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;cutoff&#39;</span><span class="p">:</span>
    <span class="n">Pt</span><span class="p">,</span> <span class="n">Ht</span> <span class="o">=</span> <span class="n">TropD_Calculate_TropopauseHeight</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="n">lev</span><span class="p">,</span> <span class="n">Z</span><span class="p">)</span>
    
    <span class="c1"># make latitude vector monotonically increasing</span>
    <span class="k">if</span> <span class="n">lat</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">lat</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
      <span class="n">Ht</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">Ht</span><span class="p">),</span><span class="mi">0</span><span class="p">)</span>
      <span class="n">lat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">lat</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
    
    <span class="n">polar_boundary</span> <span class="o">=</span> <span class="mi">60</span>
      
    <span class="n">PhiNH</span> <span class="o">=</span> <span class="n">TropD_Calculate_ZeroCrossing</span><span class="p">(</span><span class="n">Ht</span><span class="p">[(</span><span class="n">lat</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lat</span> <span class="o">&lt;</span> <span class="n">polar_boundary</span><span class="p">)]</span> <span class="o">-</span> <span class="n">Cutoff</span><span class="p">,</span>
              <span class="n">lat</span><span class="p">[(</span><span class="n">lat</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lat</span> <span class="o">&lt;</span> <span class="n">polar_boundary</span><span class="p">)])</span>
    <span class="n">PhiSH</span> <span class="o">=</span> <span class="n">TropD_Calculate_ZeroCrossing</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">Ht</span><span class="p">[(</span><span class="n">lat</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lat</span> <span class="o">&gt;</span> <span class="o">-</span><span class="n">polar_boundary</span><span class="p">)],</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-</span> <span class="n">Cutoff</span><span class="p">,</span>
              <span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">lat</span><span class="p">[(</span><span class="n">lat</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lat</span> <span class="o">&gt;</span> <span class="o">-</span><span class="n">polar_boundary</span><span class="p">)],</span> <span class="mi">0</span><span class="p">))</span>
  
  <span class="k">else</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;TropD_Metric_TPB: ERROR : Unrecognized method &#39;</span><span class="p">,</span> <span class="n">method</span><span class="p">)</span>

  <span class="k">return</span> <span class="n">PhiSH</span><span class="p">,</span> <span class="n">PhiNH</span></div>
  

<div class="viewcode-block" id="TropD_Metric_UAS"><a class="viewcode-back" href="../reference.html#metrics.TropD_Metric_UAS">[docs]</a><span class="k">def</span> <span class="nf">TropD_Metric_UAS</span><span class="p">(</span><span class="n">U</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">lev</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">]),</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;zero_crossing&#39;</span><span class="p">,</span> <span class="n">lat_uncertainty</span> <span class="o">=</span> <span class="mi">0</span><span class="p">):</span>
  
  <span class="sd">&#39;&#39;&#39; TropD near-surface zonal wind (UAS) metric</span>
<span class="sd">  </span>
<span class="sd">      Args:</span>

<span class="sd">        U(lat,lev) or U (lat,)-- Zonal mean zonal wind. Also takes surface wind </span>
<span class="sd">        </span>
<span class="sd">        lat: latitude vector</span>
<span class="sd">        </span>
<span class="sd">        lev: vertical level vector in hPa units. lev=np.array([1]) for single-level input zonal wind U(lat,)</span>

<span class="sd">        method (str): </span>
<span class="sd">          &#39;zero_crossing&#39;: the first subtropical latitude where near-surface zonal wind changes from negative to positive</span>

<span class="sd">        lat_uncertainty (float, optional): the minimal distance allowed between the first and second zero crossings</span>
<span class="sd">  </span>
<span class="sd">      Returns:</span>
<span class="sd">        tuple: PhiSH (ndarray), PhiNH (ndarray) Latitude of first subtropical zero crossing of the near surface zonal wind in SH and NH</span>
<span class="sd">        </span>
<span class="sd">  &#39;&#39;&#39;</span>

  <span class="k">try</span><span class="p">:</span>
    <span class="k">assert</span> <span class="p">(</span><span class="n">lat_uncertainty</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span>  
  <span class="k">except</span> <span class="ne">AssertionError</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;TropD_Metric_PSI: ERROR : lat_uncertainty must be &gt;= 0&#39;</span><span class="p">)</span>
    
  <span class="k">try</span><span class="p">:</span>
    <span class="k">assert</span><span class="p">(</span><span class="n">method</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;zero_crossing&#39;</span><span class="p">])</span>
  <span class="k">except</span> <span class="ne">AssertionError</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;TropD_Metric_PSI: ERROR : unrecognized method &#39;</span><span class="p">,</span> <span class="n">method</span><span class="p">)</span>
    
  <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lev</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
    <span class="n">uas</span> <span class="o">=</span> <span class="n">U</span><span class="p">[:,</span><span class="n">find_nearest</span><span class="p">(</span><span class="n">lev</span><span class="p">,</span> <span class="mi">850</span><span class="p">)]</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="n">uas</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">U</span><span class="p">)</span>
    
  <span class="c1"># make latitude vector monotonically increasing</span>
  <span class="k">if</span> <span class="n">lat</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">lat</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
      <span class="n">uas</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">uas</span><span class="p">)</span>
      <span class="n">lat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">lat</span><span class="p">)</span>

  <span class="c1"># define latitudes of boundaries certain regions </span>
  <span class="n">eq_boundary</span> <span class="o">=</span> <span class="mi">5</span>
  <span class="n">subpolar_boundary</span> <span class="o">=</span> <span class="mi">30</span>
  <span class="n">polar_boundary</span> <span class="o">=</span> <span class="mi">60</span>

  <span class="c1"># NH</span>
  <span class="n">uas_min_lat_NH</span> <span class="o">=</span> <span class="n">TropD_Calculate_MaxLat</span><span class="p">(</span><span class="o">-</span><span class="n">uas</span><span class="p">[(</span><span class="n">lat</span> <span class="o">&gt;</span> <span class="n">eq_boundary</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lat</span> <span class="o">&lt;</span> <span class="n">subpolar_boundary</span><span class="p">)],</span>\
                   <span class="n">lat</span><span class="p">[(</span><span class="n">lat</span> <span class="o">&gt;</span> <span class="n">eq_boundary</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lat</span> <span class="o">&lt;</span> <span class="n">subpolar_boundary</span><span class="p">)])</span>
  <span class="c1"># SH</span>
  <span class="n">uas_min_lat_SH</span> <span class="o">=</span> <span class="n">TropD_Calculate_MaxLat</span><span class="p">(</span><span class="o">-</span><span class="n">uas</span><span class="p">[(</span><span class="n">lat</span> <span class="o">&gt;</span> <span class="o">-</span><span class="n">subpolar_boundary</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lat</span> <span class="o">&lt;</span> <span class="o">-</span><span class="n">eq_boundary</span><span class="p">)],</span>\
      <span class="n">lat</span><span class="p">[(</span><span class="n">lat</span> <span class="o">&gt;</span> <span class="o">-</span><span class="n">subpolar_boundary</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lat</span> <span class="o">&lt;</span> <span class="o">-</span><span class="n">eq_boundary</span><span class="p">)])</span>
  <span class="k">try</span><span class="p">:</span>
    <span class="k">assert</span><span class="p">(</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;zero_crossing&#39;</span><span class="p">)</span>
    <span class="n">PhiNH</span> <span class="o">=</span> <span class="n">TropD_Calculate_ZeroCrossing</span><span class="p">(</span><span class="n">uas</span><span class="p">[(</span><span class="n">lat</span> <span class="o">&gt;</span> <span class="n">uas_min_lat_NH</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lat</span> <span class="o">&lt;</span> <span class="n">polar_boundary</span><span class="p">)],</span>\
            <span class="n">lat</span><span class="p">[(</span><span class="n">lat</span> <span class="o">&gt;</span> <span class="n">uas_min_lat_NH</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lat</span> <span class="o">&lt;</span> <span class="n">polar_boundary</span><span class="p">)],</span> <span class="n">lat_uncertainty</span><span class="o">=</span><span class="n">lat_uncertainty</span><span class="p">)</span>
    <span class="c1"># flip arrays to find the most equatorward zero crossing</span>
    <span class="n">PhiSH</span> <span class="o">=</span> <span class="n">TropD_Calculate_ZeroCrossing</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">uas</span><span class="p">[(</span><span class="n">lat</span> <span class="o">&lt;</span> <span class="n">uas_min_lat_SH</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lat</span> <span class="o">&gt;</span> <span class="o">-</span><span class="n">polar_boundary</span><span class="p">)],</span><span class="mi">0</span><span class="p">),</span>\
            <span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">lat</span><span class="p">[(</span><span class="n">lat</span> <span class="o">&lt;</span> <span class="n">uas_min_lat_SH</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">lat</span> <span class="o">&gt;</span> <span class="o">-</span><span class="n">polar_boundary</span><span class="p">)],</span><span class="mi">0</span><span class="p">),</span> <span class="n">lat_uncertainty</span><span class="o">=</span><span class="n">lat_uncertainty</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">PhiSH</span><span class="p">,</span> <span class="n">PhiNH</span>
  <span class="k">except</span> <span class="ne">AssertionError</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s1">&#39;TropD_Metric_UAS: ERROR : unrecognized method &#39;</span><span class="p">,</span> <span class="n">method</span><span class="p">)</span></div>

  

</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">PyTropD</a></h1>





<p>
<iframe src="https://ghbtns.com/github-btn.html?user=tropd&repo=pytropd&type=watch&count=None&size=large"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>




<h3>Navigation</h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../install.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorial.html">Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference.html">List of metrics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../helper.html">Additional functions</a></li>
</ul>


<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2018, Alison Ming.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.3.6</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.7</a>
      
    </div>

    

    
  </body>
</html>